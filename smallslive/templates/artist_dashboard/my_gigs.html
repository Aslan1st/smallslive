{% extends "artist_dashboard/home.html" %}
{% load add_get_parameter %}
{% load static from staticfiles %}
{% load thumbor_tags %}

{% block my-events-active %}active{% endblock %}

{% block title %}My events{% endblock %}


{% block content %}
{#    TODO Move container to dashboard base#}
    <div class="artist-profile-container">
        <div class="artist-archive-filter flex-row">
{#            FIXME Remove margin#}
            <div class="white-border-select" style="width: 150px; float:none; margin-right: 20px">
                <select id="artist_archive_status_filter">
                    <option value="all">All</option>
                    <option value="leader">Leader</option>
                    <option value="sidemusician">Sidemusician</option>
                </select>
            </div>
            <div class="white-border-select" style="width: 250px; float:none">
                <select id="artist_archive_order">
                    <option value="newest">Newest to oldest</option>
                    <option value="oldest">Oldest to newest</option>
                    <option value="draft">Most Popular</option>
                </select>
            </div>
        </div>
        <div class="flex-column items-flex-stretch">
            {% for gig_info in gigs %}
                {% with event=gig_info.event %}
                    <div class="event-row flex-row">
                        <div class="artist-event-card flex-column items-flex-stretch">
                            {% include 'events/event_card.html' with event=event %}
                            <div class="button-row button-row-margin flex-column">
                                <a style="margin-top: 30px" href="{% url "artist_dashboard:event_edit" pk=event.id slug=event.slug %}">
                                    <button style="width: 100%">Edit Event</button>
                                </a>
                            </div>
                        </div>
                        <div class="artist-event flex-column content-space-between">
                            <div class="flex-row">
                                <div class="text2 artist-event-info">
                                    {{ event.title }}
                                </div>
                                <div class="text2 accent-color artist-event-date">
                                    <div>{{ event.venue.name }} {{ event.date|date:'m/d/Y' }}</div>
                                </div>
                                <div class="text4">
                                    {% for gig_info in event.get_performers %}
                                        {{ gig_info.artist.full_name }}
                                        <span class="text-grey">({{ gig_info.role }})</span>
                                        {% if not forloop.last %}  // {% endif %}
                                    {% endfor %}
                                </div>
                            </div>
                            {% for set in event.sets.all %}
                                <div class="flex-row text2 items-center">
                                    <div class="accent-color artist-event-date">
                                        <div>
                                            {% if set.recording %}
                                                Set {{ set.recording.set_number }} - {{ set.start|date:"g:i A" }}
                                            {% else %}
                                                No set for {{ set.start|date:"g:i A" }}
                                            {% endif %}
                                        </div>
                                    </div>
                                    <div>
                                        <div class="text-grey">
                                            {% if set.video_recording %}
                                                This set is currently <span class="accent-color">
                                                {{ set.video_recording.state }}
                                            </span>
                                            {% else %}
                                                This set is not uploaded yet.
                                            {% endif %}
                                        </div>
                                    </div>
                                    <div class="artist-event-actions">
                                        {% if gig_info.is_leader %}
                                            <div class="button-row button-row-margin">
                                                <button>Publish</button>
                                                <button>Monetize</button>
                                                <button>Download</button>
                                                <a href="{% url "artist_dashboard:event_metrics" pk=event.id slug=event.slug %}">
                                                    <button>Metrics</button>
                                                </a>
                                            </div>
                                        {% else %}
                                            <div class="text-grey">
                                                <div>Leader only material.</div>
                                                <div>To access this feature, you must be a designated leader for this set.</div>
                                            </div>
                                        {% endif %}
                                    </div>
                                </div>
                            {% endfor %}

                        </div>
                    </div>
                {% endwith %}
            {% endfor %}

        </div>
    </div>
{% endblock content %}

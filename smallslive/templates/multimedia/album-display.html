{% load static from staticfiles %}
{% load thumbor_tags %}
{% load thumbnail %}
{% load currency_filters %}
{% load i18n %}
{% load purchase_info_tags %}
{% load basket_tags %}

{% block store_content %}
<section id="my-downloads-product__support" class="hidden">
  {% include 'account/product-support.html' %}
</section>
<div class="album big-player {% if library %}album--library{% endif %}"> <!--flex column container for album-->
  <div class="album__header"> <!--header container flex row-->
    <div class="album__header__cover"><!--album cover container-->
      {% with cover_art=album_product.images.first %}
        <div class="album__header__cover__artwork"><!--cover art container-->
          <img src="{% thumbor_url cover_art.original.url|urlencode height=480 width=0 %}"
               alt="{{ product.get_title }}"
               class="album__header__cover__artwork {% if all_images.count == 1 %} one-image{% else %} more-images{% endif %}">
        </div>

      {% endwith %}
      {% if can_preview or not is_catalog %}
        <div class="purchases-player-button myplay-btn album__header__cover__player-controls"><!--player control container-->
          <div class="fa-thin-circle fa album__header__cover__player-controls__play"><i class="fas fa-play" ></i></div><!--player control-->
        </div>
      {% endif %}

      <div class="album__support-buttons__container--mobile">
        <!--<div class="sponsor-text text2">Sponsor this {{ text }} artist and project with a tax-deductable donation to the smallslive foundation</div>-->
        <div>
          <button id="projectDonationBtnMobile" class="white-border-button buttons-row" style="width: 100%; margin-left: 0; font-size: 12px;">Sponsor this Artist</button>
        </div>
      </div>
    </div>
    <div class="album__track-list">
      {% for track in album_product.tracks.all|dictsort:"ordering" %}
        <!-- tracks table row -->
        <div class="track-container" style="position:relative">
          <div id="t{{ forloop.counter0 }}"
               class="my-downloads-album__tracks-table__row flex-row{% if is_catalogue and track.pk in bought_tracks %} play-on-library{% endif %}{% if track.get_track_preview_url == 'blank.mp3' and track.pk not in bought_tracks %} no-play{% endif %}"
               {% if is_catalogue and track.pk in bought_tracks %} data-url="{% url 'my-downloads' %}?album={{ album_product.pk }}"{% endif %}>
            <!-- attempts to play Library tracks on Catalog must redirect to the Library -->

            <div class="hidden my-downloads-album__tracks-table__column audio">
              {% if track.get_track_preview_url != 'blank.mp3' %}
                <audio class="audio-player" controls data-track="{{ forloop.counter0 }}" data-length="{{ track.attr.duration }}">
                  {% if track.get_track_preview_url %}
                    <source src="{{ track.get_track_preview_url|safe }}" type="audio/mpeg">
                  {% endif %}
                </audio>
              {% endif %}
            </div>

            <div class="flex-column track-info" data-track="{{ forloop.counter0 }}">
              <div class="my-downloads-album__tracks-table__column track title2 ">
                {{ track.title }}
                {% if is_catalogue and track.get_track_preview_url != 'blank.mp3' and track.pk not in bought_tracks %}
                  <span style="font-size: 10px;">(preview)</span>
                {% endif %}
              </div>
              <div class="my-downloads-album__tracks-table__column composer text1">
                {{ track.attr.composer }}
              </div>
            </div>
            <div class="store-buy my-downloads-album__tracks-table__column duration text1 {% if not is_catalogue %} {% if not track.pk in bought_tracks and not is_full = 'full_album' %} disabled {% endif %}{% endif %}">
              {{ track.attr.duration }}
            </div>
          </div>
        </div>
      {% endfor %}
      <!-- end of tracks table row -->
    </div>
    <!-- end of tracks table -->
  </div>
  <div class="album__download-buttons__container--mobile">
    <!--<div class="sponsor-text text2">Sponsor this {{ text }} artist and project with a tax-deductable donation to the smallslive foundation</div>-->
    <div>
      <button id="tracksDownloadBtnMobile" class="white-border-button buttons-row" style="width: 100%; margin-left: 0; font-size: 12px;">Download Tracks</button>
    </div>
  </div>
  <!-- This table is hidden and will be copied into the modal if the users selects to download tracks -->
  <table id="track-list-tbl" class="hidden">
    <thead>
      <tr class="table_row">
        <th>
          Track
        </th>
        <th>
          Download
        </th>
      </tr>
    </thead>
    <tbody>
      {% for track in album_product.tracks.all|dictsort:"ordering" %}
      <tr>
        <td>
          <span class="text2">{{ track.title }}</span>
        </td>
        <td>
          {% if track.get_hd_track_stockrecord.digital_download.get_downloadable_file_url %}
            <a class="link"
               href="{{ track.get_hd_track_stockrecord.digital_download.get_downloadable_file_url }}"
               download="{{ track.get_track_stockrecord.digital_download.file.name }}"
               class=" hd">hd</a>
            <span class="separator">/</span>
          {% endif %}
          {% if track.get_track_stockrecord.digital_download.get_downloadable_file_url %}
            <a class="link"
               href="{{ track.get_track_stockrecord.digital_download.get_downloadable_file_url }}"
               download="{{ track.get_hd_track_stockrecord.digital_download.file.name }}"
               class=" mp3">mp3</a>
          {% endif %}
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  <!-- end table -->
  <div>
    <div class="album__info__container">
      <div class="album__header__title"><!--album title container (maybe not necessary)-->
        <div class="album__header__title--underline">{% if album_product.parent %}{{ album_product.parent.title }} - {% endif %}{{ album_product.title }} {{ album_product.upc }}</div><!--album title-->
        <div class="album__musician-list">
          <ul>
          {% for artist_product in album_product.artistproduct_set.all %}
            <li>
              <a href="{% url 'search' %}?artist_pk={{ artist_product.artist.pk }}&return_url={{ request.path }}" class="title2">
                  {{ artist_product.artist }} / {{ artist_product.instrument }}
              </a>
            </li>
          {% endfor %}
          </ul>
        </div>
      </div>
      {% if not is_catalogue %}
        <div class="album__download-buttons__container">
          <div>
            <button id="tracksDownloadBtn" class="white-border-button buttons-row" style="margin-left: 0;">Download Tracks</button>
          </div>
        </div>
      {% elif bought_tracks %}
        <div class="album__download-buttons__container">
          <div>
            <a href="{% url 'my-downloads' %}?album={{ album_product.pk }}" class="white-border-button buttons-row" style="margin-left: 0;">View in Library</a>
          </div>
        </div>
      {% endif %}
      <div class="album__support-buttons__container">
        <!--<div class="sponsor-text text2">Sponsor this {{ text }} artist and project with a tax-deductable donation to the smallslive foundation</div>-->
        <div>
          <button id="projectDonationBtn" class="white-border-button buttons-row" style="margin-left: 0;">Sponsor this Artist</button>
        </div>
      </div>
    </div>
    <div>
      <div class="description-container text4">
        {{ album_product.description|safe }}
      </div>
    </div>
  </div>

</div>


{% endblock store_content %}

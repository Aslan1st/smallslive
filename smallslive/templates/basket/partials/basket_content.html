{% load static from staticfiles %}
{% load thumbnail %}
{% load currency_filters %}
{% load purchase_info_tags %}


<div class="content-wrapper">
    <section class="store-header container">
        <div class="store-header__content">
            <h1 class="store-header__title">SmallsLIVE Store<span class="store-header__title__divider">|</span><span
                    class="store-header__title__category">My Shopping Cart</span></h1>
        </div>
    </section>
    {% if not basket.is_empty %}
        <form action="." method="post" class="basket_summary" id="basket_formset">
            {% csrf_token %}
            {{ formset.management_form }}
            <section class="store-cart__table container">
                <div class="row">
                    {% if basket.has_physical_products %}
                        <!-- Cart table header -->
                        <div class="store-cart__table__header clearfix">
                            <div class="col-xs-12 store-cart__table__header__title">
                                <span>Physical products</span>
                            </div>
                            <div class="hidden-xs hidden-sm col-md-2 col-lg-1 store-cart__table__cell image">
                                Image
                            </div>
                            <div class="hidden-xs hidden-sm col-md-10 col-lg-11 no-padding">
                                <div class="col-xs-12 col-sm-12 col-md-3 col-lg-5 store-cart__table__cell">
                                    Item name
                                </div>
                                <div class="col-xs-12 col-sm-12 col-md-3 col-lg-3 store-cart__table__cell option">
                                    Option
                                </div>
                                <div class="store-cart__mobile-quantity col-md-6 col-lg-4">
                                    <div class="store-cart__mobile-quantity__half">
                                        <div class="col-xs-12 store-cart__table__cell quantity">
                                            <div class="store-cart__quantity-control">
                                                Quantity
                                            </div>
                                        </div>
                                    </div>
                                    <div class="store-cart__mobile-quantity__half">
                                        <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 store-cart__table__cell price">
                                            Price
                                        </div>
                                        <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 store-cart__table__cell total">
                                            Total
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- End of cart table header -->
                        {% for form in formset %}
                            {% with line=form.instance product=form.instance.product %}
                                {% if product.is_shipping_required %}
                                    {% purchase_info_for_line request line as session %}
                                    <!-- Cart table row -->
                                    <div class="store-cart__table__row clearfix">
                                        <div class="store-cart__table__row__remove">
                                            <button class="store-cart__table__remove-button" data-behaviours="remove" data-id="{{ forloop.counter0 }}"><i class="fa fa-remove"></i></button>
                                        </div>
                                        <div class="store-cart__table__row__container">
                                            <div class="col-xs-3 col-sm-3 col-md-2 col-lg-1 store-cart__table__cell image">
                                                {{ form.id }}
                                                {% with image=product.primary_image %}
                                                    {% thumbnail image.original "100x100" upscale=False as thumb %}
                                                        <a class="square-container" href="{{ product.get_absolute_url }}"><img class="defineImageRatio"
                                                                                                  src="{{ thumb.url }}"
                                                                                                  alt="{{ product.get_title }}"></a>
                                                    {% endthumbnail %}
                                                {% endwith %}
                                            </div>
                                            <div class="col-xs-8 col-sm-8 col-md-10 col-lg-11 no-padding">
                                                <div class="col-xs-12 col-sm-12 col-md-3 col-lg-5 store-cart__table__cell name">
                                                    <a href="{{ product.get_absolute_url }}">{{ line.description }}</a>
                                                </div>
                                                <div class="col-xs-12 col-sm-12 col-md-3 col-lg-3 store-cart__table__cell option">
                                                    Mens XL
                                                </div>
                                                <div class="store-cart__mobile-quantity col-md-6 col-lg-4">
                                                    <div class="store-cart__mobile-quantity__half">
                                                        <div class="col-xs-12 store-cart__table__cell quantity">
                                                            <div class="store-cart__quantity-control">
                                                                <button class="store-cart__quantity-control__button {% if form.quantity.value <= 1 %}disabled{% endif %}" data-behaviour="decrease"><i
                                                                        class="fa fa-minus-circle"></i></button>
                                                                <span class="store-cart__quantity-control__label">{{ form.quantity.value }}</span>
                                                                <input type="hidden" name="form-{{ forloop.counter0 }}-quantity"  value="{{ form.quantity.value }}"/>
                                                                <button class="store-cart__quantity-control__button" data-behaviour="increase"><i
                                                                        class="fa fa-plus-circle"></i></button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="store-cart__mobile-quantity__half">
                                                        <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 store-cart__table__cell price">
                                                            {{ line.unit_price_excl_tax|currency:line.price_currency }}
                                                        </div>
                                                        <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 store-cart__table__cell total">
                                                            {{ line.line_price_excl_tax|currency:line.price_currency }}
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-xs-1 hidden-md hidden-lg store-cart__table__cell remove">
                                                <button class="store-cart__table__remove-button" data-behaviours="remove" data-id="{{ forloop.counter0 }}"><i class="fa fa-remove"></i></button>
                                            </div>
                                        </div>
                                    </div>
                                {% endif %}
                            {% endwith %}
                            <!-- End of cart table row -->
                        {% endfor %}
                        <!-- Cart table footer -->
                        <div class="store-cart__table__footer clearfix">
                            <div class="col-xs-offset-4 col-xs-4 col-sm-offset-6 col-sm-3 col-md-offset-8 col-md-2 col-lg-offset-10 col-lg-1 store-cart__table__footer__cell">
                                Sub-total:
                            </div>
                            <div class="col-xs-4 col-sm-3 col-md-2 col-lg-1 store-cart__table__footer__cell value">
                                {{ basket.physical_total_excl_tax|currency:basket.currency }}
                            </div>
                        </div>
                        <!-- End of cart table footer -->
                    {% endif %}
                    {% if basket.has_digital_products %}
                        <!-- Cart table header -->
                        <div class="store-cart__table__header clearfix">
                            <div class="col-xs-12 store-cart__table__header__title">
                                <span>Digital downloads</span> <span class="smaller">Upon purchase your Digital downloads will be available to you in your <a
                                    href="#">My downloads</a> section.</span>
                            </div>
                            <div class="hidden-xs hidden-sm col-md-2 col-lg-1 store-cart__table__cell image">
                                Cover
                            </div>
                            <div class="hidden-xs hidden-sm col-md-10 col-lg-11 no-padding">
                                <div class="col-xs-12 col-sm-12 col-md-4 col-lg-5 store-cart__table__cell">
                                    Title
                                </div>
                                <div class="col-xs-12 col-sm-12 col-md-4 col-lg-5 store-cart__table__cell album">
                                    Album
                                </div>
                                <div class="store-cart__mobile-quantity col-md-4 col-lg-2">
                                    <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 store-cart__table__cell text-center">
                                        Option
                                    </div>
                                    <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 store-cart__table__cell price">
                                        Price
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- End of cart table header -->
                        {% for form in formset %}
                            {% with line=form.instance product=form.instance.product %}
                                {% if not product.is_shipping_required %}
                                    {% purchase_info_for_line request line as session %}
                                    <!-- Cart table row -->
                                    <div class="store-cart__table__row clearfix">
                                        <div class="store-cart__table__row__remove">
                                            <button class="store-cart__table__remove-button" data-behaviours="remove" data-id="{{ forloop.counter0 }}"><i class="fa fa-remove"></i></button>
                                        </div>
                                        <div class="store-cart__table__row__container">
                                            {{ form.id }}
                                            <div class="col-xs-3 col-sm-3 col-md-2 col-lg-1 store-cart__table__cell image">
                                                {% with image=product.album.primary_image %}
                                                    {% thumbnail image.original "100x100" upscale=False as thumb %}
                                                        <a href="{{ product.parent.get_absolute_url }}"><img class="defineImageRatio" src="{{ thumb.url }}"
                                                                 alt="{{ product.get_title }}"></a>
                                                    {% endthumbnail %}
                                                {% endwith %}
                                            </div>
                                            <div class="col-xs-8 col-sm-8 col-md-10 col-lg-11 no-padding">
                                                <div class="col-xs-12 col-sm-12 col-md-4 col-lg-5 store-cart__table__cell name">
                                                    <a href="{{ product.parent.get_absolute_url }}">{{ product.get_title }}</a>
                                                </div>
                                                <div class="col-xs-12 col-sm-12 col-md-4 col-lg-5 store-cart__table__cell album">
                                                    {% if product.album %}
                                                         {{ product.album.get_title }}
                                                    {% endif %}
                                                </div>
                                                <div class="store-cart__mobile-quantity col-md-4 col-lg-2">
                                                    <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 store-cart__table__cell text-center">
                                                        {% if line.stockrecord.is_hd %}
                                                            HD
                                                        {% else %}
                                                            Mp3
                                                        {% endif %}
                                                    </div>
                                                    <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 store-cart__table__cell total">
                                                        <input type="hidden" name="form-{{ forloop.counter0 }}-quantity"  value="{{ form.quantity.value }}"/>
                                                        {{ line.unit_price_excl_tax|currency:line.price_currency }}
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-xs-1 hidden-md hidden-lg store-cart__table__cell remove">
                                                <button class="store-cart__table__remove-button" data-behaviours="remove" data-id="{{ forloop.counter0 }}"><i class="fa fa-remove"></i></button>
                                            </div>
                                        </div>
                                    </div>
                                    {% endif %}
                                {% endwith %}
                                <!-- End of cart table row -->
                        {% endfor %}
                        <!-- Cart table footer -->
                        <div class="store-cart__table__footer clearfix">
                            <div class="col-xs-offset-4 col-xs-4 col-sm-offset-6 col-sm-3 col-md-offset-8 col-md-2 col-lg-offset-10 col-lg-1 store-cart__table__footer__cell">
                                Sub-total:
                            </div>
                            <div class="col-xs-4 col-sm-3 col-md-2 col-lg-1 store-cart__table__footer__cell value">
                                {{ basket.digital_total_excl_tax|currency:basket.currency }}
                            </div>
                        </div>
                        <!-- End of cart table footer -->
                    {% endif %}

                </div>
            </section>
            <section class="store-cart__footer container">
                <div class="col-xs-12 col-sm-6 store-cart__footer__left">
                    <p class="store-cart__footer__left__text">We accept the following payment options:</p>
                    <div class="store-cart__footer__card-icons">
                        <img src="{% static 'image/payment/visa.png' %}" alt="Visa">
                        <img src="{% static 'image/payment/mastercard.png' %}" alt="MasterCard">
                        <img src="{% static 'image/payment/amex.png' %}" alt="American Express">
                        <img src="{% static 'image/payment/diners.png' %}" alt="Diners">
                        <img src="{% static 'image/payment/paypal.png' %}" alt="Paypal">
                    </div>
                </div>
                <div class="col-xs-12 col-sm-6 store-cart__footer__right">
                    <div class="store-cart__footer__price-container">
                        <span class="store-cart__footer__price-container__value">{{ basket.total_excl_tax|currency:basket.currency }}</span>
                        <span class="store-cart__footer__price-container__label">Basket total:</span>
                        <span class="store-cart__footer__price-container__value">{{ shipping_charge.excl_tax|currency:basket.currency }}</span>
                        <span class="store-cart__footer__price-container__label">Shipping:</span>
                        <div class="store-cart__footer__price-container__total">
                            <span class="store-cart__footer__price-container__value">{{ order_total.excl_tax|currency:basket.currency }}</span>
                            <span class="store-cart__footer__price-container__label">Total:</span>
                        </div>
                    </div>
                </div>
                <div class="col-xs-12 store-cart__footer__buttons">
                    <a href="{% url 'checkout:index' %}" class="store-cart__footer__button-next">Continue checkout</a>
                </div>
            </section>
        </form>
    {% else %}
        <h1>Your basket is empty</h1>
    {% endif %}
</div>

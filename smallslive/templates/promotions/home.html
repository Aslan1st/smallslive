{#{% extends "home_new.html" %}#}
{% extends "store_base.html" %}
{% load static from staticfiles %}
{% load thumbor_tags %}
{% load category_tags %}
{% load product_tags %}
{% load purchase_info_tags %}
{% load i18n %}
{% load currency_filters %}
{% load basket_tags %}

{% block store_nav_active %}active{% endblock %}

{% block title %}SmallsLIVE Tracks{% endblock %}

{% block store_content %}
    <div class="store-listing__content">
        <div class="section-title">
          <div class="title1">featured and newest recordings</div>
        </div>
          <main class="newest-recordings-container">
            <div class="slide-btn prev"><b class="indicator-icon icon-left-caret"></b></div>
            <div class="slide-btn next"><b class="indicator-icon icon-right-caret"></b></div>
            {% include 'promotions/featured_row.html' with events=newest_recordings extra_events=featured_recordings secondary=False %}
          </main>
    </div>
{% endblock store_content %}

{% block extra_js %}
    <script src="{% static 'js/store-base.js' %}"></script>
    <script src="https://jwpsrv.com/library/w1FDmNWFEeS9qhJtO5t17w.js"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            var audioPlayer = jwplayer("player-audio").setup({
                primary: 'html5',
                playlist: [
                    {% for album in featured_recordings %}
                        {% for track in album.tracks.all|dictsort:"ordering" %}
                            {
                                sources: [{
                                    file: "{{ track.get_track_preview_url|safe }}",
                                    type: "mp3"
                                }],
                                mediaid: {{ track.id }}
                            }{% if not forloop.last %},{% endif %}
                        {% endfor %}
                        {% if not forloop.last %},{% endif %}
                    {% endfor %}
                ],
                skin: "https:{% static "jwplayer-skin/smalls.xml" %}",
                width: "100%",
                height: 0
            });
            $(".playback-control").on('click', function (e) {
                e.preventDefault();
                if (audioPlayer.getPlaylistIndex() == $(this).data('playlist-id')) {
                    audioPlayer.pause();
                } else {
                    audioPlayer.playlistItem($(this).data('playlist-id'));
                    $('.playback-control i').removeClass('fa-pause').addClass('fa-play');
                }
                $(this).find('i').toggleClass('fa-play').toggleClass('fa-pause');
            })
                
        });
    </script>
{% endblock %}


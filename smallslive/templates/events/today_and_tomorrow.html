{% load static from staticfiles %}
{% load thumbor_tags %}
{% load common_tags %}
{% load i18n %}

<section class="event-stripe {% if calendar_page %}calendar {% else %}home {% endif %}live">
  <div class="section-title {% if calendar_page %}calendar {% else %}home {% endif %}flex-row">
    <div class="title1">
      {% if calendar_page %}
        Today + Tomorrow <span class="date-separator">\</span>
      {% else %}
      Live <span class="at-the-clubs">at the clubs</span> tonight <span class="home date-separator">/</span>
      {% endif %}
    </div>

    <div class="title1 home date">{% if calendar_page %} {% get_today_and_tomorrow_dates '%a' %}  {% else %} {% now 'D b d' %} {% endif %}</div>
    {% if not calendar_page %}
      <a href='/events/calendar/' class="white-border-button">Full calendar</a>
    {% endif %}
  </div>
  <main style="position: relative;">
    <div class="slick-slide-btn prev today-and-tomorrow-arrow today-left">
      <b class="indicator-icon icon-left-caret"></b>
    </div>
    <div class="slick-slide-btn next today-and-tomorrow-arrow today-right">
      <b class="indicator-icon icon-right-caret"></b>
    </div>

    {% if calendar_page %}
      {% include 'events/tonight_events_home.html' with events=events_today show_date=True hide_event_date=True show_event_venue=True custom_venue_style=custom_venue_style %}
    {% else %}
      {% include 'events/tonight_events_home.html' with events=events_today show_date=False hide_event_date=True show_event_venue=True custom_venue_style=custom_venue_style %}
    {% endif %}
  </main>
</section>

{% block extra_js %}
<script>
  $(document).ready(function () {
		function getInitParams() {
			var $prev = $('div.today-left.prev');
			var margin = 20;
			var controlButtonWidth = $prev[0].clientWidth;

			return {
				items: 3,
				stagePadding: controlButtonWidth + margin,
				margin: margin,
				startPosition: 1,
				dots: false,
				loop: false,
				rewind: false,
				responsive:{
					0:{
						items:1,
						dots: true
					},
					780:{
						items:2
					},
					1000:{
						items:3
					}
				},
				onChanged: onChanged,
				onResized: onResized
			};
		}

		var owl = $('.owl-carousel').owlCarousel(getInitParams())

		function onResized(event) {
			owl.trigger('destroy.owl.carousel');
			owl = $('.owl-carousel').owlCarousel(getInitParams());
		}

		function onChanged(event) {
			var items = event.item.count;
			var item = event.item.index;

			if (item  == items - 3) {
				// end
				$('.today-right').hide();
				$('.today-left').show();
			} else if (item != items - 3 && item != 0) {
				// middle
				$('.today-right').show();
				$('.today-left').show();
			} else if (item  == 0) {
				// beginning
				$('.today-right').show();
				$('.today-left').hide();
			}
		}

		$('.today-right').click(function() {
			owl.trigger('next.owl.carousel');
		})

		$('.today-left').click(function() {
			owl.trigger('prev.owl.carousel', [300]);
		})
	});
</script> {% endblock %}

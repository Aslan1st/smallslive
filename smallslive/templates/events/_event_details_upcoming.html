{% extends "events/event_details_new.html" %}
{% load static from staticfiles %}
{% load thumbor_tags %}
{% load thumbnail %}
{% load currency_filters %}
{% load i18n %}
{% load purchase_info_tags %}
{% load basket_tags %}
{% load crispy_forms_tags %}
{% block event_content %}
{% include 'events/streaming_not_available_dialog.html' %}
{% include 'events/tickets_dialog.html' %}
<div class="event-video-placeholder flex-column content-space-between" style="flex: initial;">
  <span class="event-video-placeholder-picture">
    {% if event.photo %}
    <img src="{% thumbor_url event.get_photo_url|urlencode height=360 width=600 smart=True %}" style="width: 100%">
    {% else %}
    <img src="{% static 'image/no-event-image-placeholder.jpg' %}" style="width: 100%">
    {% endif %}
  </span>
  <div class="player-info pointer-events">
    <div class="live-now text2{% if not event.is_live %} hidden{% endif %}">Live now</div>
    <div class="event-overlay">
      <div class="event-title-ajax event-overlay-title">{{ event.title }}</div>
      <div class="event-overlay-artists">
        {% for gig_info in event_artists %}
          <div class="title5">
            {{ gig_info.name }} <span class="accent-color">/</span> {{ gig_info.role }}
          </div>
        {% endfor %}
      </div>
      <div class="event-overlay-venue">
          <div class="title5">{{ event.date|date:'m/d/Y' }}</div>
          {% if sets %}
              <div class="title5">
                Sets at
                {% for set in sets %}
                  <span class="event-overlay-venue-set">
                    {{ set.start|time:"g:iA"}}
                  </span>
                {% endfor %}
              </div>
          {% endif %}
        <div class="title5 accent-color">LIVE AT {{event.venue.name }}</div>
      </div>
      <div class="icon-overlay">
        <i id="btn-play-event" class="fa fa-play fa-thin-circle"></i>
      </div>
    </div>
  </div>
</div>
{% endblock %}
{% block extra_js %}
{{ block.super }}
<script>
  $(document).ready(function () {
    $('#btn-tickets').click(function () {
      $('#ticketsDialog').modal('show');
    });

    {% if event.show_streaming %}
      {% if next_event %}
        {% if next_event %}
        var changeTime = moment("{{ next_event.start.isoformat }}");
        {% endif %}

        var waitTime = changeTime.diff(moment(), 'miliseconds');
        var intervalId = setInterval(function () {
            clearInterval(intervalId);
            {% if next_event %}
            $('.current-event').addClass('hidden');
            $('.next-event').removeClass('hidden');
            $('.related-video.selected').removeClass('selected');
            $('.related-video.next-up').addClass('selected');
            {% endif %}
        }, waitTime);
      {% endif %}
    {% endif %}

    {% if streaming %}

    $('#btn-play-event').click(function () {
      var allowStreamingTime = moment("{{ streaming.start.isoformat }}");
      if (moment() - allowStreamingTime > 0) {
        window.location = "{{ streaming.event_url }}";
      } else {
        $('#streamingNotAvailableDialog').modal('show');
      }

    });

    {% endif %}

  });

</script>
{% endblock %}
{% extends "smalls_base.html" %}
{% load static from staticfiles %}
{% load thumbor_tags %}
{% load i18n %}

{% block homepage_nav_active %}active{% endblock %}

{% block title %}Smalls Jazz Club{% endblock %}

{# TODO Shouldn't be needed here #}
{% block body_class %}home{% endblock %}

{% block extra_head %}
	<meta name="description"
				content="This is the official website for Smalls Jazz Club in Greenwich Village, New York City!">
{% endblock %}

{% block header %}
{% include 'partials/header.html' %}
{% endblock %}

{% block content %}
{% include 'inactive_dialog.html' %}
{% include 'become_a_supporter_dialog.html' %}




<div class="account-settings-container-new flex-row">
	<div class="account-settings-menu">
			<div data-id="user-account" class="text1">Account info</div>
			<div data-id="user-payout" class="text1">Payout info</div>
			<div data-id="user-donation-settings" class="text1">Donation settings</div>
			<div data-id="user-billing" class="text1">Billing</div>
	</div>
	<div class="account-settings-info-container">
		<div class="flex-column">
			<div id="user-account" class="account-settings-view">
				<div class="title5 account-settings-title text-bottom-line">Account info</div>
				<div data-toggle-tab="user-account-info" data-toggle-tab-group="user-account">
					<div class="account-settings-info">
							<div class="text5">Name</div>
							<div class="text9 text-grey">{{user.first_name}} {{user.last_name}}</div>
						</div>
						<div class="account-settings-info">
							<div class="text5">Email</div>
							<div class="text9 text-grey">{{user.email}}</div>
						</div>
						<div class="account-settings-info">
							<div class="text5">Password</div>
							<div class="text9 text-grey">xxxxxxxxxx</div>
						</div>
						<button class="white-border-button" data-toggle-tab-target="user-account-form" data-toggle-tab-group="user-account"">Edit info</button>
				</div>
				<div data-toggle-tab="user-account-form" data-toggle-tab-group="user-account" style="display:none">
						{% include 'account/account-change-form.html' %}
				</div>		
			</div>
			{% if request.user.artist %}
			<div id="user-payout" class="account-settings-view">
				<div class="title5 account-settings-title text-bottom-line">Payout info</div>
				<div data-toggle-tab-group="user-payout" data-toggle-tab="user-payout-info">
					<div class="account-settings-info">
						<div class="text5">Mailing address</div>
							{% if user.address_1 or user.address_2 or user.city %}
								<div class="text9 text-grey">{{ user.address_1 }}</div>
								<div class="text9 text-grey">{{ user.address_2 }}</div>
								<div class="text9 text-grey">{{user.city }}</div>
							{% else %}
								<div class="text9 text-grey">There is no address assigned</div>
							{% endif %}
					</div>
						<button class="white-border-button" data-toggle-tab-target="user-payout-form" data-toggle-tab-group="user-payout">Edit info</button>	
				</div>
			
				<div data-toggle-tab="user-payout-form" data-toggle-tab-group="user-payout" style="display:none">
					{% include 'account/payout_info.html' %}
				</div>
			</div>
			{% endif %}
			<div id="user-donation-settings" class="account-settings-view">
				<div class="title5 account-settings-title text-bottom-line">Supporter settings</div>
				<div class="account-settings-info">
					<div class="text5">Current Monthly Pledge</div>
					{% if not customer_detail.subscription.plan %}
					<div class="text9 accent-color">None</div>
					{% else %}
					<div class="text9 accent-color">${{monthly_pledge_in_dollars}}/{{customer_detail.subscription.plan.interval}}</div>
					{% endif %}
					
					{% if active %}
						<button class="white-border-button">Become a Supporting Member</button>		
					{% elif customer_detail.subscription.plan and not period_end.due %}
						<div class="flex-row supporter-options">	
							<button class="white-border-button">Cancel</button>		
							<button class="white-border-button">Update Pledge</button>	
						</div>	
					{% else %}
						<button class="white-border-button">Make a Recurring Monthly Pledge</button>	
					{% endif %}
				</div>
			
				<div class="account-settings-info ">
					{% if customer_detail.subscription.plan %}
					<button class="white-border-button">Make a One Time Donation</button>		
					{% endif %}
				</div>
				<div class="account-settings-info ">
						<div class="text5">Expiration of archive access</div>
						<div class="text9 text-grey"> {{ period_end.date }}</div>
				</div>
				<div class="account-settings-info">
					<div class="text5">Last donation</div>
					<div class="text9 text-grey">
						{% with customer_charges|first as first_charge%}
						{% if not customer_charges %}
						You havent made and invoice yet
						{% else %}
						{{ first_charge.created|date:"d/m/Y"  }} ${{ first_charge.amount }}
						{% endif %}
						{% endwith %}
					</div>	
				</div>
				<div class="account-settings-info">
						<div class="text5">Total donations this year</div>
						<div class="text9 accent-color">${{charges_value}}</div>
				</div>
				<button class="white-border-button">Download tax document</button>		
			</div>
			
			<div id="user-billing" class="account-settings-view">
				<div class="title5 account-settings-title text-bottom-lineFin">Billing</div>
					<div class="account-settings-info">
						<div class="text5">Credit card</div>
						{% if not customer_detail.active_card %}
							<div class="text9 text-grey">There is no credit card assigned</div>
						{% else %}
							<div class="text9 text-grey">exp: {{customer_detail.active_card.exp_month}}/{{customer_detail.active_card.exp_year}}</div>
						{% endif %}
					</div>
					<div class="account-settings-info">
						<div class="text5">Billing address</div>
						{% if user.address_1 or user.address_2 or user.city %}
							<div class="text9 text-grey">{{ user.address_1 }}</div>
							<div class="text9 text-grey">{{ user.address_2 }}</div>
							<div class="text9 text-grey">{{user.city }}</div>
						{% else %}
							<div class="text9 text-grey">There is no address assigned</div>
						{% endif %}
					
					<button class="white-border-button">Update</button>	
				</div>
			</div>
		</div>
	</div>
</div>
{% endblock%}

{% block footer %}
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/tabs.js' %}"></script>
<script>
	$(".account-settings-menu .text1").on('click', function() {
		$(".account-settings-menu .text1").removeClass("white-background");
		$(this).addClass("white-background")
		$infoId = $(this).data('id')
		$infoContainerId = $("#" + $infoId)
		$infoContainer = $(".account-settings-info-container")[0]
		$($infoContainer).animate({
			scrollTop: $($infoContainer).scrollTop() + ($($infoContainerId).offset().top - $($infoContainer).offset().top)
		}, 300); 
	})

</script>

{% endblock %}
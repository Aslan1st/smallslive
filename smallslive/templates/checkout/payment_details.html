{% extends "smalls_base.html" %}
{% load static from staticfiles %}
{% load thumbor_tags %}
{% load currency_filters %}
{% load purchase_info_tags %}

{% block store_nav_active %}active{% endblock %}

{% block title %}Payment details{% endblock %}

{% block content %}

    <div class="content-wrapper">

        <section class="store-header container">
            <div class="store-header__content">
                <h1 class="store-header__title">SmallsLIVE Store<span class="store-header__title__divider">|</span><span class="store-header__title__category">Order payment</span></h1>
            </div>
        </section>
        <form id="payment-form" method="post" action="{% url "checkout:preview" %}">
          <section class="store-billing container">
              <h3 class="store__form__heading">Billing information:</h3>
              <div class="row">
                  <div class="col-xs-12 store__form__selection__container">
                          {% if shipping_address %}
                            <div class="store__form__selection__option">
                                <input type="radio" name="billing_option" id="same-address" value="same-address"
                                       {% if billing_address_form.billing_option.value != "different-address"%}checked{% endif %}><label for="same-address">My billing address is the same as the shipping
                                address</label>
                            </div>
                          {% endif %}
                          <div class="store__form__selection__option">
                              <input type="radio" name="billing_option" id="different-address"
                                     {% if billing_address_form.billing_option.value == "different-address"%}checked{% endif %} value="different-address">
                            <label for="different-address">{% if shipping_address %}My billing address is different than the shipping address{% else %}Enter billing address{% endif %}</label>
                          </div>

                  </div>
                  <div class="store__form__group clearfix" id="custom-billing-address">
                      <div class="col-xs-12 col-sm-6">
                          <label for="first_name" class="store__form__label">First name</label>
                          <input type="text" id="first_name" name="first_name" class="store__form__input" {% if billing_address_form.first_name.value %}value="{{ billing_address_form.first_name.value }}"{% endif %}>
                            {% for error in billing_address_form.first_name.errors %}
                                <span class="store__form__field-error">{{ error }}</span>
                            {% endfor %}
                          <label for="last_name" class="store__form__label">Last name</label>
                          <input type="text" id="last_name" name="last_name" class="store__form__input" {% if billing_address_form.last_name.value %}value="{{ billing_address_form.last_name.value }}"{% endif %}>
                            {% for error in billing_address_form.last_name.errors %}
                                <span class="store__form__field-error">{{ error }}</span>
                            {% endfor %}
                          <label for="phone" class="store__form__label">Phone</label>
                          <input type="tel" name="phone" id="phone" class="store__form__input" {% if billing_address_form.phone_number.value %}value="{{ billing_address_form.phone_number.value }}"{% endif %}>
                            {% for error in billing_address_form.phone_number.errors %}
                                <span class="store__form__field-error">{{ error }}</span>
                            {% endfor %}
                    </div>
                      <div class="col-xs-12 col-sm-6">
                          <label for="address1" class="store__form__label">Address - line 1</label>
                          <input type="text" name="line1" id="line1" class="store__form__input" {% if billing_address_form.line1.value %}value="{{ billing_address_form.line1.value }}"{% endif %}>
                        {% for error in billing_address_form.line1.errors %}
                                <span class="store__form__field-error">{{ error }}</span>
                            {% endfor %}
                        <label for="line2" class="store__form__label">Address - line 2</label>
                        <input type="text" name="line2" id="line2" class="store__form__input" {% if billing_address_form.line2.value %}value="{{ billing_address_form.line2.value }}"{% endif %}>
                        {% for error in billing_address_form.line2.errors %}
                                <span class="store__form__field-error">{{ error }}</span>
                            {% endfor %}
                        <div class="row">
                            <div class="col-xs-6">
                                <label for="city" class="store__form__label">City</label>
                                <input type="text" name="line4" id="city" class="store__form__input" {% if billing_address_form.line4.value %}value="{{ billing_address_form.line4.value }}"{% endif %}>
                                {% for error in billing_address_form.line4.errors %}
                                    <span class="store__form__field-error">{{ error }}</span>
                                {% endfor %}
                            </div>
                              <div class="col-xs-6">
                                  <label for="postcode" class="store__form__label">ZIP code</label>
                                <input type="text" name="postcode" id="postcode" class="store__form__input" {% if billing_address_form.postcode.value %}value="{{ billing_address_form.postcode.value }}"{% endif %}>
                                {% for error in billing_address_form.postcode.errors %}
                                    <span class="store__form__field-error">{{ error }}</span>
                                {% endfor %}
                            </div>
                        </div>
                        <label for="state" class="store__form__label">State</label>
                          <select name="state" class="store__form__select">
                                {% for val, choice in billing_address_form.fields.state.widget.choices %}
                                    <option value="{{ val }}" {% if val == billing_address_form.state.value %}selected{% endif %}>{{ choice }}</option>
                                {% endfor %}
                          </select>
                        {% for error in billing_address_form.state.errors %}
                            <span class="store__form__field-error">{{ error }}</span>
                        {% endfor %}
                          <label for="country" class="store__form__label">Country</label>
                              <select name="country" class="store__form__select">
                                  {% for val, choice in billing_address_form.fields.country.choices %}
                                    <option value="{{ val }}" {% if val == billing_address_form.country.value %}selected{% endif %}>{{ choice }}</option>
                                    {% endfor %}
                                </select>
                            {% for error in billing_address_form.country.errors %}
                                <span class="store__form__field-error">{{ error }}</span>
                            {% endfor %}
                    </div>
                </div>
            </div>
              <h3 class="store__form__heading">Payment information:</h3>
              <div class="row">
                  <div class="col-xs-12 store__form__selection__container">
                      {% if form.can_use_existing %}
                        <div class="store__form__selection__option">
                          <input type="radio" name="payment_method" id="pay-existing-credit-card" value="existing-credit-card" {% if form.payment_method.value == "existing-credit-card" %}checked{% endif %}><label for="pay-existing-credit-card">Pay with existing {{ user.customer.card_kind }} credit card ending in {{ user.customer.card_last_4 }}</label>
                        </div>
                      {% endif %}
                      <div class="store__form__selection__option">
                          <input type="radio" name="payment_method" id="pay-credit-card" value="credit-card" {% if form.payment_method.value == "credit-card" %}checked{% endif %}><label for="pay-credit-card">Pay with credit card</label>
                      </div>
                      <div class="store__form__selection__option">
                          <input type="radio" name="payment_method" id="pay-paypal" value="paypal" {% if form.payment_method.value == "paypal" %}checked{% endif %}><label for="pay-paypal">Pay with PayPal</label>
                      </div>
                  </div>
              </div>
              <div class="store__form__group clearfix row" id="credit-card-form">
                  <div class="col-xs-12 col-sm-6">
                      <p class="signup__payment__text">We accept the following credit cards:</p>
                      <div class="signup__payment__card-icons">
                          <img src="{% static 'image/payment/visa.png' %}" alt="Visa">
                          <img src="{% static 'image/payment/mastercard.png' %}" alt="MasterCard">
                          <img src="{% static 'image/payment/amex.png' %}" alt="American Express">
                          <img src="{% static 'image/payment/diners.png' %}" alt="Diners">
                      </div>
                      <div class="signup__payment__card__info">
                          {% csrf_token %}
                          <label for="card-number" class="store__form__label">Credit card number</label>
                          <input type="text" class="store__form__input"  id="card-number" placeholder="XXXX XXXX XXXX XXXX" size="20" pattern="[\d ]*" autocomplete="off" name="number" {% if form.number.value %}value="{{ form.number.value }}"{% endif %}>
                            {% for error in form.number.errors %}
                                <span class="store__form__field-error">{{ error }}</span>
                            {% endfor %}
                            {% if error %}
                                <span class="store__form__field-error">{{ error|safe }}</span>
                            {% endif %}
                          <div class="row">
                              <div class="col-xs-3">
                                  <label for="expiry" id="expiry-label" class="store__form__label">Valid thru:</label>
                                  <input type="text" class="store__form__input" id="expiry-month" placeholder="MM" size="2" pattern="\d*" autocomplete="off" name="exp_month" {% if form.exp_month.value %}value="{{ form.exp_month.value }}"{% endif %}>
                                  {% for error in form.exp_month.errors %}
                                <span class="store__form__field-error">{{ error }}</span>
                            {% endfor %}
                              </div>
                              <div class="col-xs-3">
                                  <label for="expiry" id="expiry-label" class="store__form__label"> </label>
                                  <input type="text" class="store__form__input" id="expiry-year" placeholder="YY" size="2" pattern="\d*" autocomplete="off" name="exp_year" {% if form.exp_year.value %}value="{{ form.exp_year.value }}"{% endif %}>
                                  {% for error in form.exp_year.errors %}
                                <span class="store__form__field-error">{{ error }}</span>
                            {% endfor %}
                              </div>
                              <div class="col-xs-6">
                                  <label for="cvc" id="cvc-label" class="store__form__label">CVC</label>
                                  <input type="text" class="store__form__input" id="cvc" placeholder="xxx" size="4" pattern="\d*" autocomplete="off" name="cvc" {% if form.cvc.value %}value="{{ form.cvc.value }}"{% endif %}>
                                  {% for error in form.cvc.errors %}
                                <span class="store__form__field-error">{{ error }}</span>
                            {% endfor %}
                              </div>
                          </div>
                          <label for="name" class="store__form__label">Name on card</label>
                          <input type="text" class="store__form__input" placeholder="Name on card" autocomplete="off" name="name" {% if form.name.value %}value="{{ form.name.value }}"{% endif %}>
                          <div class="payment-errors"></div>
                      </div>
                  </div>
                  <div class="col-xs-12 col-sm-6 signup__payment__card__image">
                      <div class="card-wrapper"></div>
                  </div>
              </div>
              <div class="store__form__group clearfix row" id="paypal-form">
                  <div class="col-xs-12 col-sm-6">
                      <p class="signup__payment__text">You'll be taken to a separate PayPal screen later on during the purchase process.</p>
                  </div>
              </div>
          </section>
          <section class="store-cart__footer container">
              <div class="col-xs-12 col-sm-6 store-cart__footer__left">
                  <p class="store-cart__footer__left__text">We accept the following payment options:</p>
                  <div class="store-cart__footer__card-icons">
                      <img src="{% static 'image/payment/visa.png' %}" alt="Visa">
                      <img src="{% static 'image/payment/mastercard.png' %}" alt="MasterCard">
                      <img src="{% static 'image/payment/amex.png' %}" alt="American Express">
                      <img src="{% static 'image/payment/diners.png' %}" alt="Diners">
                      <img src="{% static 'image/payment/paypal.png' %}" alt="Paypal">
                  </div>
              </div>
              <div class="col-xs-12 col-sm-6 store-cart__footer__right">
                  <div class="store-cart__footer__price-container">
                    <span class="store-cart__footer__price-container__value">{{ basket.total_excl_tax|currency:basket.currency }}</span>
                    <span class="store-cart__footer__price-container__label">Basket total:</span>
                    <span class="store-cart__footer__price-container__value">{{ shipping_charge.excl_tax|currency:basket.currency }}</span>
                    <span class="store-cart__footer__price-container__label">Shipping:</span>
                    <div class="store-cart__footer__price-container__total">
                        <span class="store-cart__footer__price-container__value">{{ order_total.excl_tax|currency:basket.currency }}</span>
                        <span class="store-cart__footer__price-container__label">Total:</span>
                    </div>
                  </div>
              </div>
              <div class="col-xs-12 store-cart__footer__buttons">
                  <a href="#" class="store-cart__footer__button-back"><i class="fa fa-angle-double-left"></i> Back to something</a>
                  <button class="store-cart__footer__button-next">Continue checkout</button>
              </div>
          </section>
        </form>
    </div>

{% endblock content %}


{% block extra_js %}
    <script src="{% static 'js/store-base.js' %}"></script>
    <script src="{% static 'js/card.js' %}"></script>
    <script>
      var card = new Card({
        // a selector or DOM element for the form where users will
        // be entering their information
        form: '#payment-form', // *required*
        // a selector or DOM element for the container
        // where you want the card to appear
        container: '.card-wrapper', // *required*

        formSelectors: {
          numberInput: 'input[name="number"]', // optional — default input[name="number"]
          expiryInput: 'input[name="exp_month"], input[name="exp_year"]', // optional — default input[name="expiry"]
          cvcInput: 'input[name="cvc"]', // optional — default input[name="cvc"]
          nameInput: 'input[name="name"]' // optional - defaults input[name="name"]
        },

        width: 350, // optional — default 350px
        formatting: true, // optional - default true


        // Default values for rendered fields - optional
        values: {
          number: '•••• •••• •••• ••••',
          name: 'Name',
          expiry: '••/••',
          cvc: '•••'
        },

        // if true, will log helpful messages for setting up Card
        debug: false // optional - default false
      });
    </script>
    <script>
        /* Settings payment div reveal Paypal js */
        $(document).ready(function () {
            if ($('input[name=billing_option]:checked').val() === "same-address") {
                $("#custom-billing-address").css("display", "none");
            }
            $(".store__form__selection__option").click(function(){
                if ($('input[name=billing_option]:checked').val() === "different-address") {
                    $("#custom-billing-address").slideDown("fast"); //Slide Down Effect
                } else {
                    $("#custom-billing-address").slideUp("fast");
                }
            });

            if ($('input[name=payment_method]:checked').val() === "paypal") {
                $("#credit-card-form").css("display", "none");
            } else if ($('input[name=payment_method]:checked').val() === "credit-card") {
                $("#paypal-form").css("display", "none");
            } else {
                $("#paypal-form").css("display", "none");
                $("#credit-card-form").css("display", "none");
            }
            $(".store__form__selection__option").click(function(){
                if ($('input[name=payment_method]:checked').val() === "credit-card") {
                    $("#paypal-form").slideUp("fast");
                    $("#credit-card-form").slideDown("fast"); //Slide Down Effect
                } else if($('input[name=payment_method]:checked').val() === "paypal") {
                    $("#credit-card-form").slideUp("fast");
                    $("#paypal-form").slideDown("fast"); //Slide Down Effect
                } else {
                    $("#credit-card-form").slideUp("fast");
                    $("#paypal-form").slideUp("fast"); //Slide Down Effect
                }
            });
        });
    </script>
{% endblock %}

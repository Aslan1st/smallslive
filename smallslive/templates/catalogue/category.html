{% extends "store_base.html" %}
{% load basket_tags %}
{% load promotion_tags %}
{% load category_tags %}
{% load product_tags %}
{% load i18n %}
{% load purchase_info_tags %}
{% load static from staticfiles %}
{% load thumbor_tags %}
{% load currency_filters %}


{% block store_nav_active %}active{% endblock %}

{% block store_content %}
    <div class="col-xs-12 col-sm-8 col-md-9 col-sm-push-4 col-md-push-3 store-listing__content">
        {% if featured_product %}
            {% purchase_info_for_product request featured_product as session %}
            <div class="store-subtle-heading">Featured</div>
            <div class="store-listing__big-item row">
                <div class="col-xs-12 col-sm-6 store-listing__big-item__image">
                    {% with image=featured_product.primary_image %}
                        {% if not image.is_missing %}
                          <a href="{{ featured_product.get_absolute_url }}"><img src="{% thumbor_url image.original.url|urlencode width=400 smart=True %}" alt="{{ featured_product.get_title }}"></a>
                        {% else %}
                          <a href="{{ featured_product.get_absolute_url }}"><img src="{% static "image/image_not_found.jpg" %}" alt="{{ featured_product.get_title }}"></a>
                        {% endif %}
                    {% endwith %}
                </div>
                <div class="col-xs-12 col-sm-6 store-listing__big-item__content">
                    <h2 class="store-listing__big-item__name">
                        <a href="#">{{ featured_product.title }}</a>
                    </h2>
                    <p class="store-listing__big-item__description">
                        {{ featured_product.short_description|safe }}
                    </p>
                    <p class="store-listing__big-item__details">
                        {{ featured_product.description|safe }}
                    </p>
                        {% if session.price.exists %}
                            {% if session.price.excl_tax == 0 %}
                                <span class="store-listing__big-item__price">{% trans "Free" %}</span>
                            {% elif session.price.is_tax_known %}
                                <span class="store-listing__big-item__price">{{ session.price.incl_tax|currency:session.price.currency }}</span>
                            {% else %}
                                <span class="store-listing__big-item__price">{{ session.price.excl_tax|currency:session.price.currency }}</span>
                            {% endif %}
                        {% else %}
                            <span class="store-listing__big-item__price">&nbsp;</span>
                        {% endif %}
                    <form id="add_to_basket_form" action="{% url 'basket:add' pk=featured_product.pk  %}" method="post" class="add-to-basket">
                      {% if session.availability.is_available_to_buy %}
                        {% basket_form request product 'single' as basket_form %}
                        <div class="store-add-large">
                            {% csrf_token %}
                            {{ basket_form.quantity }}
                            {% if basket_form.fields.child_id.choices %}
                              <select class="store-add-large__options" name="child_id">
                                  {% for item_value, item_name in basket_form.fields.child_id.choices %}
                                    <option value="{{ item_value }}">{{ item_name }}</option>
                                  {% endfor %}
                              </select>
                              <div class="arrow-button-container"><button type="submit" class="store-add-large__button"><i class="fa fa-plus"></i></button><span class="arrow"></span></div>
                            {% else %}
                              {{ basket_form.child_id }}
                              <div class="arrow-button-container"><button type="submit" class="store-add-large__button">Add to cart</button><span class="arrow"></span></div>
                            {% endif %}
                        </div>
                      {% endif %}
                    </form>
                </div>
            </div>
        {% endif %}
        <div class="row">
            {% if products %}
                {% for product in products %}
                    {% render_product product %}
                {% endfor %}
                {% include "partials/pagination.html" %}
            {% else %}
                <p class="nonefound">{% trans "No products found." %}</p>
            {% endif %}
        </div>
    </div>
{% endblock store_content %}
